volumes:
  ui:

services:
  backend:
    build:
      context: ./services/backend/
      dockerfile: ./Dockerfile
    command: ros2 launch cart_launch autonomous_launcher.launch.py #can be overriden with $BACKEND_COMMAND
    environment:
      - BACKEND_COMMAND #will override the default command above
      - ROS_DOMAIN_ID=0
      - $HOME/.ssh:/root/.ssh
      - $HOME/.gitconfig:/root/.gitconfig
      - DISPLAY
      - XDG_RUNTIME_DIR
      - RMW_IMPLEMENTATION: rmw_fastrtps_cpp
      - FASTRTPS_DEFAULT_PROFILES_FILE: /rmw_profile.xml
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix
      - $HOME/.Xauthority:/root/.Xauthority
      - /dev:/dev
      - /home/jacart/jacart-project/dev_ws:/dev_ws
      - ./rmw_profile.xml:/rmw_profile.xml
    privileged: true
    runtime: nvidia
    network_mode: "host"
  frontend:
    build:
      context: ./services/frontend/
      dockerfile: ./Dockerfile
    command: npm run dev #can be overriden with $FRONTEND_COMMAND
    environment:
      - FRONTEND_COMMAND #will override the default command above
    network_mode: "host"
    volumes:
      - $HOME/.ssh:/root/.ssh
      - $HOME/.gitconfig:/root/.gitconfig
      - ui:/ui
  fer:
    build:
      context: ./services/fer/
      dockerfile: ./Dockerfile
    command: python3 EmotionDetection.py
    environment:
      - FER_COMMAND
      - ROS_DOMAIN_ID=0
      - RMW_IMPLEMENTATION: rmw_fastrtps_cpp
      - FASTRTPS_DEFAULT_PROFILES_FILE: /rmw_profile.xml
    volumes:
      - /home/jacart/jacart-project/dev_ws/src/FER_DataCollection/OA_SECRET.txt:/mnt/OA_SECRET.txt # grabbing OA_secret
      - /home/jacart/jacart-project/dev_ws:/dev_ws # think about getting specific to the repo
      - ./rmw_profile.xml:/rmw_profile.xml
    privileged: true
    runtime: nvidia
    network_mode: "host"
    stdin_open: true
    tty: true